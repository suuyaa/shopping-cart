import{CREATE as e,DELETE as r,DELETE_MANY as t,GET_LIST as n,GET_MANY as o,GET_MANY_REFERENCE as i,GET_ONE as a,UPDATE as s,UPDATE_MANY as u}from"react-admin";import c from"path-browserify";import{isEmpty as l,get as f,set as d}from"lodash";import"firebase/firestore";import"firebase/storage";import p from"firebase/app";import"firebase/auth";const h=function(){function e(){}return e.prototype.then=function(r,t){const n=new e,o=this.s;if(o){const e=1&o?r:t;if(e){try{m(n,1,e(this.v))}catch(e){m(n,2,e)}return n}return this}return this.o=function(e){try{const o=e.v;1&e.s?m(n,1,r?r(o):o):t?m(n,1,t(o)):m(n,2,o)}catch(e){m(n,2,e)}},n},e}();function m(e,r,t){if(!e.s){if(t instanceof h){if(!t.s)return void(t.o=m.bind(null,e,r));1&r&&(r=t.s),t=t.v}if(t&&t.then)return void t.then(m.bind(null,e,r),m.bind(null,e,2));e.s=r,e.v=t;const n=e.o;n&&n(e)}}function v(e,r){try{var t=e()}catch(e){return r(e)}return t&&t.then?t.then(void 0,r):t}"undefined"!=typeof Symbol&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator"))),"undefined"!=typeof Symbol&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));var y=function(){this.title="ðŸ”¥r-a-f: "},P={log:{configurable:!0},warn:{configurable:!0},error:{configurable:!0}};y.prototype.isEnabled=function(){return!!localStorage.getItem("LOGGING_ENABLED")},P.log.get=function(){return this.isEnabled()?console.log.bind(console,this.title):function(){for(var e=[],r=arguments.length;r--;)e[r]=arguments[r]}},P.warn.get=function(){return this.isEnabled()?console.warn.bind(console,this.title):function(){for(var e=[],r=arguments.length;r--;)e[r]=arguments[r]}},P.error.get=function(){return this.isEnabled()?console.error.bind(console,this.title):function(){for(var e=[],r=arguments.length;r--;)e[r]=arguments[r]}},Object.defineProperties(y.prototype,P);var g=new y;function b(e,r){e&&e.debug||r.logging?localStorage.setItem("LOGGING_ENABLED","true"):localStorage.removeItem("LOGGING_ENABLED")}var w=g.log,j=g.error;function k(e,r,t){e.sort(function(e,n){var o=e[r],i=n[r],a="asc"===t;return Number.isFinite(o)&&Number.isFinite(i)?R(o,i,a):"string"==typeof o&&"string"==typeof i?R(o.toLowerCase(),i.toLowerCase(),a):o instanceof Date&&i instanceof Date?R(o,i,a):R(!!o,!!i,a)})}function R(e,r,t){return e>r?t?1:-1:e<r?t?-1:1:0}function G(e,r){if(l(r))return e;var t=[];return Object.keys(r).map(function(e){var n=function(e,r){if(!r)return[{searchField:e,searchValue:r}];var t={};return t[e]=r,function(e){var r=[],t=function(e,n){for(var o in n=n||"",e)if(e.hasOwnProperty(o)){var i=e[o],a=n?n+"."+o:o;"object"==typeof i||i instanceof Array?t(i,a):r.push({searchField:a,searchValue:i})}};return t(e,null),r}(t)}(e,r[e]);t.push.apply(t,n)}),e.filter(function(e){return t.reduce(function(r,t){return function(e,r,t){var n=e[r];return r.includes(".")&&(n=f(e,r)),!n&&!t||!!n&&("string"==typeof t?n.toString().toLowerCase().includes(t.toLowerCase()):("boolean"==typeof t||"number"==typeof t)&&n===t)}(e,t.searchField,t.searchValue)&&r},!0)})}function T(e,r){if(!e)return r;if(!r)throw new Error("Resource name must be a string of length greater than 0 characters");var t=c.join("/",e,"/",r,"/");if((t.split("/").length-1)%2)throw new Error('The rootRef path must point to a "document" not a "collection"\ne.g. /collection/document/ or /collection/document/collection/document/');return t.slice(1,-1)}var D=function(e,r){this.fireWrapper=e,this.options=r,this.resources={},this.db=e.db()};D.prototype.GetResource=function(e){var r=this.resources[e];if(!r)throw new Error('react-admin-firebase: Cant find resource: "'+e+'"');return r},D.prototype.TryGetResourcePromise=function(e,r){try{var t=this;return w("resourceManager.TryGetResourcePromise",{relativePath:e,collectionQuery:r}),Promise.resolve(t.initPath(e,r)).then(function(){var r=t.resources[e];if(!r)throw new Error('react-admin-firebase: Cant find resource: "'+e+'"');return r})}catch(e){return Promise.reject(e)}},D.prototype.RefreshResource=function(e,r){try{var t=this;return w("resourceManager.RefreshResource",{relativePath:e,collectionQuery:r}),Promise.resolve(t.initPath(e,r)).then(function(){var n=t.resources[e],o=n.collection,i=t.applyQuery(o,r);return Promise.resolve(i.get()).then(function(e){n.list=e.docs.map(function(e){return t.parseFireStoreDocument(e)}),w("resourceManager.RefreshResource",{newDocs:e,resource:n,collectionPath:o.path})})})}catch(e){return Promise.reject(e)}},D.prototype.GetSingleDoc=function(e,r){try{var t=this;return Promise.resolve(t.initPath(e)).then(function(){var n=t.resources[e];return Promise.resolve(n.collection.doc(r).get()).then(function(o){if(!o.exists)throw new Error("react-admin-firebase: No id found matching: "+r);var i=t.parseFireStoreDocument(o);return w("resourceManager.GetSingleDoc",{relativePath:e,resource:n,docId:r,docSnap:o,result:i}),i})})}catch(e){return Promise.reject(e)}},D.prototype.initPath=function(e,r){try{var t=T(this.options&&this.options.rootRef,e),n=!!this.resources[e];if(w("resourceManager.initPath()",{absolutePath:t,hasBeenInited:n}),n)return w("resourceManager.initPath() has been initialized already..."),Promise.resolve();var o=this.db.collection(t),i={collection:o,list:[],path:e,pathAbsolute:t};return this.resources[e]=i,w("resourceManager.initPath() setting resource...",{resource:i,allResources:this.resources,collection:o,collectionPath:o.path}),Promise.resolve()}catch(e){return Promise.reject(e)}},D.prototype.parseFireStoreDocument=function(e){var r,t=e.data();return(r=t)&&"object"==typeof r&&Object.keys(r).map(function(e){r[e]=function e(r){return r?"object"!=typeof r?r:r.toDate&&"function"==typeof r.toDate?r.toDate():Array.isArray(r)?r.map(function(r){return e(r)}):"object"==typeof r?(Object.keys(r).map(function(t){r[t]=e(r[t])}),r):void 0:r}(r[e])}),Object.assign({},{id:e.id},t)},D.prototype.getUserLogin=function(){try{var e=this;return Promise.resolve(new Promise(function(r,t){e.fireWrapper.auth().onAuthStateChanged(function(e){r(e)})}))}catch(e){return Promise.reject(e)}},D.prototype.removeResource=function(e){delete this.resources[e]},D.prototype.applyQuery=function(e,r){var t;return t=r?r(e):e,w("resourceManager.applyQuery() ...",{collection:e,collectionQuery:(r||"-").toString(),collref:t}),t};var A=function(e,r){this.fireWrapper=e,this.options=r,this.db=e.db(),this.rm=new D(this.fireWrapper,this.options)};A.prototype.apiGetList=function(e,r){try{var t=this;w("apiGetList",{resourceName:e,params:r});var n=r.filter||{},o=n.collectionQuery;return delete n.collectionQuery,Promise.resolve(t.tryGetResource(e,"REFRESH",o)).then(function(e){var o=e.list;if(null!=r.sort){var i=r.sort;k(o,i.field,"ASC"===i.order?"asc":"desc")}var a=o;t.options.softDelete&&!Object.keys(n).includes("deleted")&&(a=o.filter(function(e){return!e.deleted}));var s=G(a,n),u=(r.pagination.page-1)*r.pagination.perPage;return{data:s.slice(u,u+r.pagination.perPage),total:s.length}})}catch(e){return Promise.reject(e)}},A.prototype.apiGetOne=function(e,r){try{var t=this;return w("apiGetOne",{resourceName:e,params:r}),Promise.resolve(v(function(){return Promise.resolve(t.rm.GetSingleDoc(e,r.id)).then(function(e){return{data:e}})},function(){throw new Error("Error getting id: "+r.id+" from collection: "+e)}))}catch(e){return Promise.reject(e)}},A.prototype.apiCreate=function(e,r){try{var t=this;return Promise.resolve(t.tryGetResource(e)).then(function(n){var o=!1;function i(e){if(o)return e;var i=t.db.collection("collections").doc().id;return Promise.resolve(t.parseDataAndUpload(n,i,r.data)).then(function(e){var r=Object.assign({},e);return t.checkRemoveIdField(r),Promise.resolve(t.addCreatedByFields(r)).then(function(){return Promise.resolve(t.addUpdatedByFields(r)).then(function(){return Promise.resolve(n.collection.doc(i).set(r,{merge:!1})).then(function(){return{data:Object.assign({},e,{id:i})}})})})})}w("apiCreate",{resourceName:e,resource:n,params:r});var a=r.data&&r.data.id;w("apiCreate",{hasOverridenDocId:a});var s=function(){if(a){var e=r.data.id;return Promise.resolve(n.collection.doc(e).get()).then(function(i){if(i.exists)throw new Error('the id:"'+e+"\" already exists, please use a unique string if overriding the 'id' field");return Promise.resolve(t.parseDataAndUpload(n,e,r.data)).then(function(r){if(!e)throw new Error("id must be a valid string");var i=Object.assign({},r);return t.checkRemoveIdField(i),Promise.resolve(t.addCreatedByFields(i)).then(function(){return Promise.resolve(t.addUpdatedByFields(i)).then(function(){return w("apiCreate",{docObj:i}),Promise.resolve(n.collection.doc(e).set(i,{merge:!1})).then(function(){return o=!0,{data:Object.assign({},r,{id:e})}})})})})})}}();return s&&s.then?s.then(i):i(s)})}catch(e){return Promise.reject(e)}},A.prototype.apiUpdate=function(e,r){try{var t=this,n=r.id;return delete r.data.id,Promise.resolve(t.tryGetResource(e)).then(function(o){return w("apiUpdate",{resourceName:e,resource:o,params:r}),Promise.resolve(t.parseDataAndUpload(o,n,r.data)).then(function(e){var r=Object.assign({},e);return t.checkRemoveIdField(r),Promise.resolve(t.addUpdatedByFields(r)).then(function(){return o.collection.doc(n).update(r).catch(function(e){j("apiUpdate error",{error:e})}),{data:Object.assign({},e,{id:n})}})})})}catch(e){return Promise.reject(e)}},A.prototype.apiUpdateMany=function(e,r){try{var t=this;return delete r.data.id,Promise.resolve(t.tryGetResource(e)).then(function(n){return w("apiUpdateMany",{resourceName:e,resource:n,params:r}),Promise.resolve(Promise.all(r.ids.map(function(e){try{return Promise.resolve(t.parseDataAndUpload(n,e,r.data)).then(function(r){var o=Object.assign({},r);return t.checkRemoveIdField(o),Promise.resolve(t.addUpdatedByFields(o)).then(function(){return Promise.resolve(n.collection.doc(e).update(o)).then(function(){return Object.assign({},r,{id:e})})})})}catch(e){return Promise.reject(e)}}))).then(function(e){return{data:e}})})}catch(e){return Promise.reject(e)}},A.prototype.apiSoftDelete=function(e,r){try{var t=this,n=r.id;return Promise.resolve(t.tryGetResource(e)).then(function(o){w("apiSoftDelete",{resourceName:e,resource:o,params:r});var i={deleted:!0};return Promise.resolve(t.addUpdatedByFields(i)).then(function(){return o.collection.doc(n).update(i).catch(function(e){j("apiSoftDelete error",{error:e})}),{data:Object.assign({},r.previousData,{id:n})}})})}catch(e){return Promise.reject(e)}},A.prototype.apiSoftDeleteMany=function(e,r){try{var t=this;return Promise.resolve(t.tryGetResource(e)).then(function(n){return w("apiSoftDeleteMany",{resourceName:e,resource:n,params:r}),Promise.resolve(Promise.all(r.ids.map(function(e){try{var o={deleted:!0};return Promise.resolve(t.addUpdatedByFields(o)).then(function(){return n.collection.doc(e).update(o).catch(function(e){j("apiSoftDeleteMany error",{error:e})}),Object.assign({},r.data,{id:e})})}catch(e){return Promise.reject(e)}}))).then(function(e){return{data:e}})})}catch(e){return Promise.reject(e)}},A.prototype.apiDelete=function(e,r){try{return Promise.resolve(this.tryGetResource(e)).then(function(t){function n(e){return{data:r.previousData}}w("apiDelete",{resourceName:e,resource:t,params:r});var o=v(function(){return Promise.resolve(t.collection.doc(r.id).delete()).then(function(){})},function(e){throw new Error(e)});return o&&o.then?o.then(n):n()})}catch(e){return Promise.reject(e)}},A.prototype.apiDeleteMany=function(e,r){try{var t=this;return Promise.resolve(t.tryGetResource(e)).then(function(n){function o(e){return{data:i}}w("apiDeleteMany",{resourceName:e,resource:n,params:r});for(var i=[],a=t.db.batch(),s=0,u=r.ids;s<u.length;s+=1){var c=u[s];a.delete(n.collection.doc(c)),i.push({id:c})}var l=v(function(){return Promise.resolve(a.commit()).then(function(){})},function(e){throw new Error(e)});return l&&l.then?l.then(o):o()})}catch(e){return Promise.reject(e)}},A.prototype.apiGetMany=function(e,r){try{var t=this;return Promise.resolve(t.tryGetResource(e,"REFRESH")).then(function(n){return w("apiGetMany",{resourceName:e,resource:n,params:r}),Promise.resolve(Promise.all(r.ids.map(function(e){return n.collection.doc(e).get()}))).then(function(e){var r=e.map(function(e){return Object.assign({},e.data(),{id:e.id})});return{data:t.options.softDelete?r.filter(function(e){return!e.deleted}):r}})})}catch(e){return Promise.reject(e)}},A.prototype.apiGetManyReference=function(e,r){try{var t=this;return Promise.resolve(t.tryGetResource(e,"REFRESH")).then(function(n){w("apiGetManyReference",{resourceName:e,resource:n,params:r});var o=n.list,i=r.target,a=r.id,s=r.filter||{},u=o;t.options.softDelete&&(u=o.filter(function(e){return!e.deleted}));var c=G(u,s),l={};l[i]=a;var f=G(c,l);if(null!=r.sort){var d=r.sort;k(f,d.field,"ASC"===d.order?"asc":"desc")}var p=(r.pagination.page-1)*r.pagination.perPage;return{data:f.slice(p,p+r.pagination.perPage),total:f.length}})}catch(e){return Promise.reject(e)}},A.prototype.tryGetResource=function(e,r,t){try{var n=this;function o(){return n.rm.TryGetResourcePromise(e,t)}var i=function(){if(r)return Promise.resolve(n.rm.RefreshResource(e,t)).then(function(){})}();return Promise.resolve(i&&i.then?i.then(o):o())}catch(e){return Promise.reject(e)}},A.prototype.getCurrentUserEmail=function(){try{return Promise.resolve(this.rm.getUserLogin()).then(function(e){return e?e.email:"annonymous user"})}catch(e){return Promise.reject(e)}},A.prototype.getCurrentUserId=function(){try{return Promise.resolve(this.rm.getUserLogin()).then(function(e){return e?e.uid:"annonymous user"})}catch(e){return Promise.reject(e)}},A.prototype.parseDataAndUpload=function(e,r,t){try{var n=this;if(!t)return Promise.resolve(t);var o=e.collection.doc(r).path,i=function(e){if(!e||"object"!=typeof e)return[];var r=[];return Object.keys(e).map(function(t){!function e(r,t,n){return r?"object"!=typeof r?r:r.toDate&&"function"==typeof r.toDate?r.toDate():Array.isArray(r)?r.map(function(r,o){return e(r,t+"."+o,n)}):"object"==typeof r?r&&r.hasOwnProperty("rawFile")?(n.push({fieldDotsPath:t,fieldSlashesPath:t.split(".").join("/"),rawFile:r.rawFile}),void delete r.rawFile):(Object.keys(r).map(function(o){e(r[o],t+"."+o,n)}),r):void 0:r}(e[t],t,r)}),r}(t);return Promise.resolve(Promise.all(i.map(function(e){try{return Promise.resolve(n.uploadAndGetLink(e.rawFile,o,e.fieldSlashesPath)).then(function(r){d(t,e.fieldDotsPath+".src",r)})}catch(e){return Promise.reject(e)}}))).then(function(){return t})}catch(e){return Promise.reject(e)}},A.prototype.checkRemoveIdField=function(e){this.options.dontAddIdFieldToDoc&&delete e.id},A.prototype.addCreatedByFields=function(e){try{var r=this;return r.options.disableMeta?Promise.resolve():Promise.resolve(r.options.associateUsersById?r.getCurrentUserId():r.getCurrentUserEmail()).then(function(t){switch(r.options.metaFieldCasing){case"camel":e.createDate=r.fireWrapper.serverTimestamp(),e.createdBy=t;break;case"snake":e.create_date=r.fireWrapper.serverTimestamp(),e.created_by=t;break;case"pascal":e.CreateDate=r.fireWrapper.serverTimestamp(),e.CreatedBy=t;break;case"kebab":e["create-date"]=r.fireWrapper.serverTimestamp(),e["created-by"]=t;break;default:e.createdate=r.fireWrapper.serverTimestamp(),e.createdby=t}})}catch(e){return Promise.reject(e)}},A.prototype.addUpdatedByFields=function(e){try{var r=this;return r.options.disableMeta?Promise.resolve():Promise.resolve(r.options.associateUsersById?r.getCurrentUserId():r.getCurrentUserEmail()).then(function(t){switch(r.options.metaFieldCasing){case"camel":e.lastUpdate=r.fireWrapper.serverTimestamp(),e.updatedBy=t;break;case"snake":e.last_update=r.fireWrapper.serverTimestamp(),e.updated_by=t;break;case"pascal":e.LastUpdate=r.fireWrapper.serverTimestamp(),e.UpdatedBy=t;break;case"kebab":e["last-update"]=r.fireWrapper.serverTimestamp(),e["updated-by"]=t;break;default:e.lastupdate=r.fireWrapper.serverTimestamp(),e.updatedby=t}})}catch(e){return Promise.reject(e)}},A.prototype.uploadAndGetLink=function(e,r,t){try{var n=c.join(r,t);return Promise.resolve(this.saveFile(n,e))}catch(e){return Promise.reject(e)}},A.prototype.saveFile=function(e,r){try{w("saveFile() saving file...",{storagePath:e,rawFile:r});var t=this.fireWrapper.storage().ref(e).put(r);return Promise.resolve(v(function(){return Promise.resolve(new Promise(function(e,r){return t.then(e).catch(r)})).then(function(r){return Promise.resolve(r.ref.getDownloadURL()).then(function(t){return w("saveFile() saved file",{storagePath:e,taskResult:r,getDownloadURL:t}),t})})},function(e){j("storage/unknown"===e.code?'saveFile() error saving file, No bucket found! Try clicking "Get Started" in firebase -> storage':"saveFile() error saving file",{storageError:e})}))}catch(e){return Promise.reject(e)}};var F,S=function(){};function U(c,l){var f=l||{};!function(e,r){if(!(e||r&&r.app))throw new Error("Please pass the Firebase firebaseConfig object or options.app to the FirebaseAuthProvider");r.rootRef&&T(r.rootRef,"test")}(c,f),b(c,f),w("react-admin-firebase:: Creating FirebaseDataProvider",{firebaseConfig:c,options:f});var d=new S;return d.init(c,l),F=new A(d,f),function(c,l,d){try{var p;return w("FirebaseDataProvider: event",{type:c,resourceName:l,params:d}),Promise.resolve(v(function(){var v=function(e,r){var t,n=-1;e:{for(var o=0;o<r.length;o++){var i=r[o][0];if(i){var a=i();if(a&&a.then)break e;if(a===e){n=o;break}}else n=o}if(-1!==n){do{for(var s=r[n][1];!s;)s=r[++n][1];var u=s();if(u&&u.then){t=!0;break e}var c=r[n][2];n++}while(c&&!c());return u}}const l=new h,f=m.bind(null,l,2);return(t?u.then(d):a.then(function t(a){for(;;){if(a===e){n=o;break}if(++o===r.length){if(-1!==n)break;return void m(l,1,u)}if(i=r[o][0]){if((a=i())&&a.then)return void a.then(t).then(void 0,f)}else n=o}do{for(var s=r[n][1];!s;)s=r[++n][1];var u=s();if(u&&u.then)return void u.then(d).then(void 0,f);var c=r[n][2];n++}while(c&&!c());m(l,1,u)})).then(void 0,f),l;function d(e){for(;;){var t=r[n][2];if(!t||t())break;for(var o=r[++n][1];!o;)o=r[++n][1];if((e=o())&&e.then)return void e.then(d).then(void 0,f)}m(l,1,e)}}(c,[[function(){return o},function(){return Promise.resolve(F.apiGetMany(l,d)).then(function(e){p=e})}],[function(){return i},function(){return Promise.resolve(F.apiGetManyReference(l,d)).then(function(e){p=e})}],[function(){return n},function(){return Promise.resolve(F.apiGetList(l,d)).then(function(e){p=e})}],[function(){return a},function(){return Promise.resolve(F.apiGetOne(l,d)).then(function(e){p=e})}],[function(){return e},function(){return Promise.resolve(F.apiCreate(l,d)).then(function(e){p=e})}],[function(){return s},function(){return Promise.resolve(F.apiUpdate(l,d)).then(function(e){p=e})}],[function(){return u},function(){return Promise.resolve(F.apiUpdateMany(l,d)).then(function(e){p=e})}],[function(){return r},function(){var e=f.softDelete?Promise.resolve(F.apiSoftDelete(l,d)).then(function(e){p=e}):Promise.resolve(F.apiDelete(l,d)).then(function(e){p=e});return e&&e.then?e.then(function(){}):void 0}],[function(){return t},function(){var e=f.softDelete?Promise.resolve(F.apiSoftDeleteMany(l,d)).then(function(e){p=e}):Promise.resolve(F.apiDeleteMany(l,d)).then(function(e){p=e});return e&&e.then?e.then(function(){}):void 0}],[void 0,function(){throw new Error('Unknkown dataprovider command type: "'+c+'"')}]]);return v&&v.then?v.then(function(e){return p}):p},function(e){var r=e.toString(),t=function(e){switch(/\[code\=([\w-]*)/g.exec(r)[1]){case"unauthenticated":return 401;case"permission-denied":return 403;case"internal":return 0;case"invalid-argument":return 400;case"not-found":return 404;case"aborted":return 409;case"resource-exhausted":return 429;case"cancelled":return 499;case"internal":return 500;case"unimplemented":return 501;case"unavailable":return 503;case"deadline-exceeded":return 504;default:return 200}}(),n={status:t,message:r,json:p};throw j("DataProvider:",e,{errorMsg:r,code:t,errorObj:n}),n}))}catch(e){return Promise.reject(e)}}}S.prototype.init=function(e,r){this.options=r,this.app=function(e,r){return r.app?r.app:p.apps.length?p.app():p.initializeApp(e)}(e,r),this.firestore=this.app.firestore()},S.prototype.db=function(){return this.firestore},S.prototype.serverTimestamp=function(){return new Date},S.prototype.auth=function(){return this.app.auth()},S.prototype.storage=function(){return this.app.storage()};var E=function(e,r){var t=r||{};w("Auth Client: initializing...",{firebaseConfig:e,options:t});var n=new S;n.init(e,t),this.auth=n.auth(),this.setPersistence(t.persistence)};function I(e,r){!function(e,r){if(!(e||r&&r.app))throw new Error("Please pass the Firebase firebaseConfig object or options.app to the FirebaseAuthProvider")}(e,r);var t=new E(e,r);return b(e,r),{login:function(e){return t.HandleAuthLogin(e)},logout:function(){return t.HandleAuthLogout()},checkAuth:function(){return t.HandleAuthCheck()},checkError:function(e){return t.HandleAuthError(e)},getPermissions:function(){return t.HandleGetPermissions()},getJWTAuthTime:function(){return t.HandleGetJWTAuthTime()},getJWTExpirationTime:function(){return t.HandleGetJWTExpirationTime()},getJWTSignInProvider:function(){return t.HandleGetJWTSignInProvider()},getJWTClaims:function(){return t.HandleGetPermissions()},getJWTToken:function(){return t.HandleGetJWTToken()}}}E.prototype.setPersistence=function(e){var r;switch(e){case"local":r=p.auth.Auth.Persistence.LOCAL;break;case"none":r=p.auth.Auth.Persistence.NONE;break;case"session":default:r=p.auth.Auth.Persistence.SESSION}w("setPersistence",{persistenceInput:e,persistenceResolved:r}),this.auth.setPersistence(r).catch(function(e){return console.error(e)})},E.prototype.HandleAuthLogin=function(e){try{var r=this,t=e.username,n=e.password;return t&&n?Promise.resolve(v(function(){return Promise.resolve(r.auth.signInWithEmailAndPassword(t,n)).then(function(e){return w("HandleAuthLogin: user sucessfully logged in",{user:e}),e})},function(){throw w("HandleAuthLogin: invalid credentials",{params:e}),new Error("Login error: invalid credentials")})):Promise.resolve(r.getUserLogin())}catch(e){return Promise.reject(e)}},E.prototype.HandleAuthLogout=function(){return this.auth.signOut()},E.prototype.HandleAuthError=function(e){return w("HandleAuthLogin: invalid credentials",{errorHttp:e}),"ok"===function(e){if(e>=200&&e<300)return"ok";switch(e){case 401:case 403:return"unauthenticated";case 0:case 400:case 404:case 409:case 429:case 499:case 500:case 501:case 503:case 504:default:return"ok"}}(!!e&&e.status)?Promise.resolve("API is authenticated"):Promise.reject("Recieved authentication error from API")},E.prototype.HandleAuthCheck=function(){return this.getUserLogin()},E.prototype.getUserLogin=function(){var e=this;return new Promise(function(r,t){if(e.auth.currentUser)return r(e.auth.currentUser);var n=e.auth.onAuthStateChanged(function(e){n(),e?r(e):t()})})},E.prototype.HandleGetPermissions=function(){try{var e=this;return Promise.resolve(v(function(){return Promise.resolve(e.getUserLogin()).then(function(e){return Promise.resolve(e.getIdTokenResult()).then(function(e){return e.claims})})},function(e){return w("HandleGetPermission: no user is logged in or tokenResult error",{e:e}),null}))}catch(e){return Promise.reject(e)}},E.prototype.HandleGetJWTAuthTime=function(){try{var e=this;return Promise.resolve(v(function(){return Promise.resolve(e.getUserLogin()).then(function(e){return Promise.resolve(e.getIdTokenResult()).then(function(e){return e.authTime})})},function(e){return w("HandleGetJWTAuthTime: no user is logged in or tokenResult error",{e:e}),null}))}catch(e){return Promise.reject(e)}},E.prototype.HandleGetJWTExpirationTime=function(){try{var e=this;return Promise.resolve(v(function(){return Promise.resolve(e.getUserLogin()).then(function(e){return Promise.resolve(e.getIdTokenResult()).then(function(e){return e.expirationTime})})},function(e){return w("HandleGetJWTExpirationTime: no user is logged in or tokenResult error",{e:e}),null}))}catch(e){return Promise.reject(e)}},E.prototype.HandleGetJWTSignInProvider=function(){try{var e=this;return Promise.resolve(v(function(){return Promise.resolve(e.getUserLogin()).then(function(e){return Promise.resolve(e.getIdTokenResult()).then(function(e){return e.signInProvider})})},function(e){return w("HandleGetJWTSignInProvider: no user is logged in or tokenResult error",{e:e}),null}))}catch(e){return Promise.reject(e)}},E.prototype.HandleGetJWTIssuedAtTime=function(){try{var e=this;return Promise.resolve(v(function(){return Promise.resolve(e.getUserLogin()).then(function(e){return Promise.resolve(e.getIdTokenResult()).then(function(e){return e.issuedAtTime})})},function(e){return w("HandleGetJWTIssuedAtTime: no user is logged in or tokenResult error",{e:e}),null}))}catch(e){return Promise.reject(e)}},E.prototype.HandleGetJWTToken=function(){try{var e=this;return Promise.resolve(v(function(){return Promise.resolve(e.getUserLogin()).then(function(e){return Promise.resolve(e.getIdTokenResult()).then(function(e){return e.token})})},function(e){return w("HandleGetJWTIssuedAtTime: no user is logged in or tokenResult error",{e:e}),null}))}catch(e){return Promise.reject(e)}};export{U as FirebaseDataProvider,I as FirebaseAuthProvider};
//# sourceMappingURL=index.mjs.map
